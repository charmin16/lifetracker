<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dreams & Visions - LifeTracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --accent-color: #7209b7;
            --light-bg: #f8f9fa;
            --dark-text: #212529;
        }

        body {
            background-color: var(--light-bg);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--dark-text);
            padding-bottom: 50px;
        }

        .navbar-custom {
            background-color: var(--primary-color);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .idea-card {
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 12px;
            background: #fff;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }

        .progress-circle {
            position: relative;
            width: 100px;
            height: 100px;
            margin: 0 auto 15px;
        }

        .progress-circle svg {
            transform: rotate(-90deg);
            width: 100%;
            height: 100%;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
        }

        .requirements ul {
            padding-left: 20px;
            margin-bottom: 0;
        }

        .requirements li {
            margin-bottom: 5px;
        }

        .status-badge {
            font-size: 0.85rem;
            padding: 5px 10px;
            border-radius: 20px;
        }

        .btn-action {
            margin-right: 8px;
            margin-bottom: 8px;
        }

        /* Desktop styles */
        @media (min-width: 992px) {
            .progress-container {
                display: flex;
                align-items: flex-start;
            }

            .idea-content {
                flex: 1;
                padding-right: 20px;
            }

            .progress-circle {
                margin: 0 0 0 20px;
                flex-shrink: 0;
            }
        }

        /* Mobile styles */
        @media (max-width: 991px) {
            .idea-card {
                text-align: center;
                padding: 15px;
            }

            .progress-circle {
                margin: 15px auto;
            }

            .btn-group-responsive {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
            }

            .btn-action {
                flex: 1;
                min-width: 120px;
                margin: 5px;
            }

            .mobile-simple .idea-content {
                padding: 0 10px;
            }

            .mobile-simple .requirements {
                margin: 15px 0;
            }

            .mobile-simple .requirements ul {
                text-align: left;
            }
        }

        /* Color coding for priorities */
        .priority-High {
            color: #dc3545;
            font-weight: 600;
        }

        .priority-Medium {
            color: #fd7e14;
            font-weight: 600;
        }

        .priority-Low {
            color: #20c997;
            font-weight: 600;
        }

        /* Status badges */
        .status-Not-Started {
            background-color: #6c757d;
            color: white;
        }

        .status-In-Progress {
            background-color: #17a2b8;
            color: white;
        }

        .status-Done {
            background-color: #28a745;
            color: white;
        }

        .section-title {
            color: #6f42c1;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .empty-state {
            padding: 40px 20px;
            text-align: center;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .card {
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            border: none;
            margin-bottom: 25px;
        }

        .card-header {
            background-color: white;
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
            font-weight: 600;
            padding: 15px 20px;
            border-radius: 12px 12px 0 0 !important;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark navbar-custom">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="bi bi-speedometer2"></i> LifeTracker
            </a>
            <div class="d-flex">
                <div class="dropdown me-2">
                    <button class="btn btn-outline-light btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                        <i class="bi bi-grid"></i> Features
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="{% url 'expense_home' %}">
                            <i class="bi bi-wallet2 me-2"></i>Expense Tracker
                        </a></li>
                        <li><a class="dropdown-item" href="{% url 'create_idea' %}">
                            <i class="bi bi-bullseye me-2"></i>Vision Board
                        </a></li>
                    </ul>
                </div>
                <form method="POST" action="{% url 'logout' %}" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-outline-light btn-sm">
                        <i class="bi bi-box-arrow-right"></i> Logout
                    </button>
                </form>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap">
            <h2 class="mb-0 section-title">ðŸŒŸ My Dreams & Visions</h2>
            <button class="btn btn-primary mt-2 mt-md-0" type="button" data-bs-toggle="collapse" data-bs-target="#ideaForm">
                <i class="bi bi-plus-circle me-2"></i>Add New Vision
            </button>
        </div>

        <!-- Add Dream Form -->
        <div class="collapse mb-4" id="ideaForm">
            <div class="card shadow">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-stars me-2"></i>Add New Dream/Vision</h5>
                </div>
                <div class="card-body">
                    <form method="POST">
                        {% csrf_token %}
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                {{ form.title.label_tag }}
                                {{ form.title }}
                            </div>
                            <div class="col-md-6 mb-3">
                                {{ form.category.label_tag }}
                                {{ form.category }}
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="{{ form.objective.id_for_label }}">My Goals</label>
                            {{ form.objective }}
                            <div class="form-text">Enter one goal per line, or leave empty if nothing comes to mind yet.</div>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                {{ form.priority.label_tag }}
                                {{ form.priority }}
                            </div>
                            <div class="col-md-4 mb-3">
                                {{ form.status.label_tag }}
                                {{ form.status }}
                            </div>
                            <div class="col-md-4 mb-3">
                                {{ form.target_date.label_tag }}
                                {{ form.target_date }}
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="{{ form.requirements_text.id_for_label }}">Resources/Requirements</label>
                            {{ form.requirements_text }}
                            <div class="form-text">Enter one resource or requirement per line, or leave empty if nothing comes to mind yet.</div>
                        </div>

                        <button type="submit" class="btn btn-success"><i class="bi bi-check-circle me-2"></i>Save Dream</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Filter form -->
        <div class="card mb-4 shadow-sm">
            <div class="card-header">
                <button class="btn btn-link text-decoration-none w-100 text-start d-flex justify-content-between align-items-center p-0" type="button" data-bs-toggle="collapse" data-bs-target="#filterForm">
                    <span><i class="bi bi-funnel me-2"></i>Filter Dreams/Visions</span>
                    <i class="bi bi-chevron-down"></i>
                </button>
            </div>
            <div class="collapse" id="filterForm">
                <div class="card-body">
                    <form method="get" class="row g-2">
                        <div class="col-md-4">
                            <select name="category" class="form-select">
                                <option value="">-- All Categories --</option>
                                {% for val, label in form.fields.category.choices %}
                                    <option value="{{ val }}" {% if selected_category == val %}selected{% endif %}>{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-4">
                            <select name="status" class="form-select">
                                <option value="">-- All Statuses --</option>
                                {% for val, label in form.fields.status.choices %}
                                    <option value="{{ val }}" {% if selected_status == val %}selected{% endif %}>{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-4">
                            <select name="priority" class="form-select">
                                <option value="">-- All Priorities --</option>
                                {% for val, label in form.fields.priority.choices %}
                                    <option value="{{ val }}" {% if selected_priority == val %}selected{% endif %}>{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-12 text-end mt-2">
                            <button type="submit" class="btn btn-primary btn-sm"><i class="bi bi-filter me-2"></i>Apply Filters</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Ideas list -->
        {% if ideas %}
            <div class="row">
                {% for idea in ideas %}
                <div class="col-12 mb-4">
                    <div class="idea-card mobile-simple">
                        <div class="progress-container">
                            <div class="idea-content">
                                <div class="d-flex justify-content-between align-items-start mb-2 flex-wrap">
                                    <h4 class="mb-0">{{ idea.title }}</h4>
                                    <span class="status-badge status-{{ idea.status|slugify }} mt-2 mt-md-0">{{ idea.status }}</span>
                                </div>

                                <div class="row mb-2 text-start">
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong><i class="bi bi-grid me-2"></i>Category:</strong> {{ idea.category }}</p>
                                        <p class="mb-1"><strong><i class="bi bi-exclamation-triangle me-2"></i>Priority:</strong> <span class="priority-{{ idea.priority }}">{{ idea.priority }}</span></p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong><i class="bi bi-calendar-event me-2"></i>Target Date:</strong> {{ idea.target_date|date:"M d, Y"|default:"Not set" }}</p>
                                    </div>
                                </div>

                                <!-- My Goals (previously Objectives) -->
                                {% if idea.objective %}
                                    <div class="mb-3 text-start">
                                        <h6><i class="bi bi-bullseye me-2"></i>My Goals:</h6>
                                        {{ idea.formatted_objectives|safe }}
                                    </div>
                                {% endif %}

                                <!-- Resources/Requirements (previously Requirements) -->
                                <div class="requirements mb-3 text-start">
                                    <h6><i class="bi bi-list-check me-2"></i>Resources/Requirements:</h6>
                                    <ul>
                                        {% for req in idea.requirements.all %}
                                            <li>{% if req.is_done %}âœ…{% else %}â­•{% endif %} {{ req.text }}</li>
                                        {% empty %}
                                            <li class="text-muted">No requirements yet.</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>

                            <!-- Progress circle -->
                            <div class="progress-circle">
                                <svg viewBox="0 0 100 100">
                                    <!-- Gray background -->
                                    <circle cx="50" cy="50" r="45" stroke="#f0f0f0" stroke-width="10" fill="none"></circle>
                                    <!-- Green progress -->
                                    <circle cx="50" cy="50" r="45"
                                            stroke="#4caf50"
                                            stroke-width="10"
                                            fill="none"
                                            stroke-dasharray="283"
                                            stroke-dashoffset="{{ idea.circle_offset }}"
                                            stroke-linecap="round"></circle>
                                </svg>
                                <div class="progress-text">{{ idea.progress_pct }}%</div>
                            </div>
                        </div>

                        <!-- Action buttons -->
                        <div class="btn-group-responsive mt-3">
                            <a href="{% url 'update_idea' idea.id %}" class="btn btn-warning btn-action"><i class="bi bi-pencil me-2"></i>Update</a>
                            <form method="post" action="{% url 'mark_done' idea.id %}" class="d-inline">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-success btn-action"><i class="bi bi-check-lg me-2"></i>Mark Done</button>
                            </form>
                            <a href="{% url 'delete_idea' idea.id %}" class="btn btn-danger btn-action"><i class="bi bi-trash me-2"></i>Delete</a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <i class="bi bi-cloud-plus" style="font-size: 60px; color: #6f42c1; margin-bottom: 20px;"></i>
                <h4>No visions yet</h4>
                <p class="text-muted">Start by adding your first dream using the button above</p>
                <button class="btn btn-primary mt-3" type="button" data-bs-toggle="collapse" data-bs-target="#ideaForm">
                    <i class="bi bi-plus-circle me-2"></i>Add Your First Dream/Vision
                </button>
            </div>
        {% endif %}
    </div>

    <!-- Footer -->
    <footer class="mt-5 py-4 bg-light">
        <div class="container text-center">
            <p class="mb-0">LifeTracker &copy; 2023 - Your Complete Life Management Solution</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Fix for progress circle offset calculation
        document.addEventListener('DOMContentLoaded', function() {
            const progressCircles = document.querySelectorAll('.progress-circle');

            progressCircles.forEach(circle => {
                const progressText = circle.querySelector('.progress-text');
                const progressValue = parseInt(progressText.textContent);
                const circleSvg = circle.querySelector('circle:last-child');

                // Calculate the correct offset
                const circumference = 283; // 2 * Ï€ * 45
                const offset = circumference - (progressValue / 100 * circumference);

                // Set the stroke-dashoffset
                circleSvg.style.strokeDashoffset = offset;
            });
        });
    </script>
</body>
</html>